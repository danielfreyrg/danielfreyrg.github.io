<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ávöxtun</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div>
        <h1>Bera saman ávöxtun</h1>
        <div class="wrapper">
            <div class="input-container">
                <label for="years">Fjöldi ára</label>
                <input type="number" id="years" value="2">
                <label for="interest">Vextir (prósenta)</label>
                <input type="number" id="interest" value="8.25">
                <label for="tax">Fjármagnstekjuskattur (prósenta)</label>
                <input type="number" id="tax" value="22">
                <label for="amount">Upprunaleg upphæð</label>
                <input type="number" id="amount1" value="50000000">
                <div id="investment2">
                    <h2>Fjárfesting 2</h2>
                    <label for="amount">Upprunaleg upphæð</label>
                    <input type="number" id="amount2" value="76000000">
                </div>
            </div>
            <div class="result-container">
                <h2>Ávöxtun 1</h2>
                <div class="results1">
                    <p id="totalresult1"></p>
                    <p id="interestresult1"></p>
                    <p id="taxresult1"></p>
                    <p id="totaltax1"></p>
                    <p id="monthlyprofit1"></p>
                </div>
                <div class="results2">
                    <h2>Ávöxtun 2</h2>
                    <p id="totalresult2"></p>
                    <p id="interestresult2"></p>
                    <p id="taxresult2"></p>
                    <p id="totaltax2"></p>
                    <p id="monthlyprofit2"></p>
                </div>
            </div>
        </div>
    </div>
    <div class="checkbox-container">
    <input type="checkbox" id="compare" checked>
    <label for="compare">Bera saman við önnur gildi</label>
</div>
    <br/>
    <div class="checkbox-container">
    <input type="checkbox" id="toggleScale">
    <label for="toggleScale">Skala frá núlli</label>
</div>
    <br/>
    <button id="disablePlots">Gera öll gröf óvirk</button>
    <canvas id="myChart"></canvas>
    <script>
        let myChart;
        let scaleFromZero = false;

        document.getElementById('toggleScale').addEventListener('change', function() {
            scaleFromZero = this.checked;
            calculateAndCompare();
        });

        document.getElementById('disablePlots').addEventListener('click', function() {
            disableAllPlots();
        });

        function formatISK(amount) {
            let amountStr = amount.toFixed(2);
            let parts = amountStr.split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return parts.join(',');
        }

        function calculateAndCompare() {
            const result1 = calculate('1');
            let result2;
            if (document.getElementById('compare').checked) {
                result2 = calculate('2');
            } else {
                result2 = { totalValues: [], interestValues: [], taxValues: [], totalProfitValues: [] };
            }
            generateChart(result1.totalValues, result2.totalValues, result1.interestValues, result2.interestValues, result1.taxValues, result2.taxValues, result1.totalProfitValues, result2.totalProfitValues, result1.years);
            updateResults(
                result1.totalValues[result1.totalValues.length - 1],
                result1.interestValues[result1.interestValues.length - 1] / result1.years,
                result1.taxValues[result1.taxValues.length - 1] / result1.years,
                result1.totalValues[result1.totalValues.length - 1] - result1.totalValues[0],
                result2.totalValues[result2.totalValues.length - 1],
                result2.interestValues[result2.interestValues.length - 1] / result2.years,
                result2.taxValues[result2.taxValues.length - 1] / result2.years,
                result2.totalValues[result2.totalValues.length - 1] - result2.totalValues[0]
            );
        }

        function calculate(suffix) {
            const amount = parseFloat(document.getElementById('amount' + suffix).value);
            const years = parseFloat(document.getElementById('years').value) * 12;
            const tax = parseFloat(document.getElementById('tax').value) / 100;
            const interest = parseFloat(document.getElementById('interest').value) / 100;

            let total = amount;
            let totalInterest = 0;
            let totalTax = 0;
            const totalValues = [amount];
            const taxValues = [];
            const interestValues = [];
            const totalProfitValues = [];

            for (let i = 0; i < years; i++) {
                const currentInterest = total * (interest / 12);
                const currentTax = currentInterest * tax;
                totalInterest += currentInterest;
                totalTax += currentTax;
                total += (currentInterest - currentTax);
                taxValues.push(totalTax);
                interestValues.push(totalInterest);
                totalValues.push(total);
                totalProfitValues.push(total - amount);
            }

            return { totalValues, interestValues, taxValues, totalProfitValues, years, tax, interest };
        }

        function generateChart(totalValues1, totalValues2, interestValues1, interestValues2, taxValues1, taxValues2, totalProfitValues1, totalProfitValues2, years) {
  const ctx = document.getElementById('myChart').getContext('2d');

  if (myChart) {
    myChart.destroy();
  }

  const datasets = [
    {
      label: 'Heildarupphæð 1',
      data: totalValues1,
      borderColor: 'rgb(75, 192, 192)',
      fill: false
    },
    {
      label: 'Heildarupphæð 2',
      data: totalValues2,
      borderColor: 'rgb(255, 159, 64)',
      fill: false
    },
    {
      label: 'Vextir 1',
      data: interestValues1,
      borderColor: 'rgb(54, 162, 235)',
      fill: false
    },
    {
      label: 'Vextir 2',
      data: interestValues2,
      borderColor: 'rgb(153, 102, 255)',
      fill: false
    },
    {
      label: 'Fjármagnstekjuskattur 1',
      data: taxValues1,
      borderColor: 'rgb(255, 99, 132)',
      fill: false
    },
    {
      label: 'Fjármagnstekjuskattur 2',
      data: taxValues2,
      borderColor: 'rgb(255, 99, 132)',
      fill: false
    },
    {
      label: 'Heildarhagnaður 1',
      data: totalProfitValues1,
      borderColor: 'rgb(255, 206, 86)',
      fill: false
    },
    {
      label: 'Heildarhagnaður 2',
      data: totalProfitValues2,
      borderColor: 'rgb(255, 206, 86)',
      fill: false
    }
  ];

  const chartData = {
    labels: [...Array(years).keys()].map(i => i + 1),
    datasets: datasets
  };

  myChart = new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: {
      responsive: true,
      title: {
        display: true,
        text: 'Fjárhagurleg áhorfun'
      },
      tooltips: {
        mode: 'index',
        intersect: false,
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        x: {
          display: true,
          title: {
            display: true,
            text: 'Mánuðir'
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: 'Upphæð'
          },
          beginAtZero: scaleFromZero
        }
      }
    }
  });
}


        function disableAllPlots() {
            if (myChart) {
                myChart.data.datasets.forEach(dataset => {
                    dataset.hidden = true;
                });
                myChart.update();
            }
        }

        function updateResults(total1, interest1, tax1, totalProfit1, total2, interest2, tax2, totalProfit2) {
            const totalFormatted1 = formatISK(total1);
            const interestFormatted1 = formatISK(interest1);
            const taxFormatted1 = formatISK(tax1);
            const totalProfitFormatted1 = formatISK(totalProfit1);
            const totalFormatted2 = formatISK(total2);
            const interestFormatted2 = formatISK(interest2);
            const taxFormatted2 = formatISK(tax2);
            const totalProfitFormatted2 = formatISK(totalProfit2);
            var years = document.getElementById('years').value;
            const monthlyprofit1Formatted = formatISK(totalProfit1 / (years * 12));
            const monthlyprofit2Formatted = formatISK(totalProfit2 / (years * 12));
            

            document.querySelector('.results1 #totalresult1').innerHTML = `Heildarupphæð 1 eftir ${years} ár: <span class="amount">${totalFormatted1}</span> kr`;
            document.querySelector('.results1 #interestresult1').innerHTML = `Samtals vextir 1 eftir ${years} ár: <span class="amount">${interestFormatted1}</span> kr`;
            document.querySelector('.results1 #taxresult1').innerHTML = `Samtals fjármagnstekjuskattur 1 eftir ${years} ár: <span class="amount">${taxFormatted1}</span> kr`;
            document.querySelector('.results1 #totaltax1').innerHTML = `Heildarhagnaður 1 eftir ${years} ár: <span class="amount">${totalProfitFormatted1}</span> kr`;
            document.querySelector('.results2 #totalresult2').innerHTML = `Heildarupphæð 2 eftir ${years} ár: <span class="amount">${totalFormatted2}</span> kr`;
            document.querySelector('.results2 #interestresult2').innerHTML = `Samtals vextir 2  eftir ${years} ár: <span class="amount">${interestFormatted2}</span> kr`;
            document.querySelector('.results2 #taxresult2').innerHTML = `Samtals fjármagnstekjuskattur 2 eftir ${years} ár: <span class="amount">${taxFormatted2}</span> kr`;
            document.querySelector('.results2 #totaltax2').innerHTML = `Heildarhagnaður 2 eftir ${years} ár: <span class="amount">${totalProfitFormatted2}</span> kr`;
            document.querySelector('.results1 #monthlyprofit1').innerHTML = `Mánaðarlegur hagnaður 1: <span class="amount">${monthlyprofit1Formatted}</span> kr`;
            document.querySelector('.results2 #monthlyprofit2').innerHTML = `Mánaðarlegur hagnaður 2: <span class="amount">${monthlyprofit2Formatted}</span> kr`;
        }

        ['amount1', 'amount2', 'years', 'tax', 'interest', 'compare'].forEach(id => {
            document.getElementById(id).onchange = calculateAndCompare;
        });

        document.getElementById('compare').onchange = function() {
            document.getElementById('investment2').style.display = this.checked ? 'block' : 'none';
            calculateAndCompare();
        };

        calculateAndCompare();
    </script>
</body>
</html>
