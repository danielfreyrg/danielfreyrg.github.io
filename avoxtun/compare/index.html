<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ávöxtun</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div>
        <h1>Bera saman ávöxtun</h1>
        <div class="wrapper">
            <div class="input-container">
              <div class="investment-container">
                <label for="years1">Fjöldi ára</label>
                <input type="number" id="years1" value="2">
                <label for="interest1">Vextir (prósenta)</label>
                <input type="number" id="interest1" value="8.25">
                <label for="tax1">Fjármagnstekjuskattur (prósenta)</label>
                <input type="number" id="tax1" value="22">
                <label for="amount1">Upprunaleg upphæð</label>
                <input type="number" id="amount1" value="50000000">
              </div>
              <h2>Fjárfesting 2</h2>
                <div class="investment-container">
                    <label for="years2">Fjöldi ára</label>
                    <input type="number" id="years2" value="2">
                    <label for="interest2">Vextir (prósenta)</label>
                    <input type="number" id="interest2" value="8.25">
                    <label for="tax2">Fjármagnstekjuskattur (prósenta)</label>
                    <input type="number" id="tax2" value="22">
                    <label for="amount2">Upprunaleg upphæð</label>
                    <input type="number" id="amount2" value="76000000">
                </div>
            </div>
            <div class="result-container">
                <h2>Ávöxtun 1</h2>
                <div class="results1">
                    <p id="totalresult1"></p>
                    <p id="interestresult1"></p>
                    <p id="taxresult1"></p>
                    <p id="totaltax1"></p>
                    <p id="monthlyprofit1"></p>
                </div>
                <div class="results2">
                    <h2>Ávöxtun 2</h2>
                    <p id="totalresult2"></p>
                    <p id="interestresult2"></p>
                    <p id="taxresult2"></p>
                    <p id="totaltax2"></p>
                    <p id="monthlyprofit2"></p>
                </div>
            </div>
        </div>
    </div>
    <div class="checkbox-container">
        <input type="checkbox" id="compare" checked>
        <label for="compare">Bera saman við önnur gildi</label>
    </div>
    <br/>
    <div class="checkbox-container">
        <input type="checkbox" id="toggleScale">
        <label for="toggleScale">Skala frá núlli</label>
    </div>
    <br/>
    <button id="disablePlots">Gera öll gröf óvirk</button>
    <canvas id="myChart"></canvas>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          let myChart;
          let scaleFromZero = false;

          document.getElementById('toggleScale').addEventListener('change', function() {
            scaleFromZero = this.checked;
            calculateAndCompare();
          });

          document.getElementById('disablePlots').addEventListener('click', function() {
            disableAllPlots();
          });
          function formatISK(amount) {
  const suffixes = ['', 'þúsund', 'milljón', 'milljarður', 'billjón', 'billjarður', 'trilljón', 'trilljarður', 'kvadrilljón', 'kvadrilljarður'];
  let suffixIndex = 0;
  let originalAmount = amount;

  while (amount >= 1000 && suffixIndex < suffixes.length - 1) {
    amount /= 1000;
    suffixIndex++;
  }

  const formattedAmount = amount.toLocaleString('is-IS');
  const textAmount = formattedAmount + ' ' + suffixes[suffixIndex];
  const fullAmountText = originalAmount.toLocaleString('is-IS') + 'kr (' + textAmount + ')';
  return fullAmountText;
}





          function calculateAndCompare() {
            const result1 = calculate('1');
            let result2;
            if (document.getElementById('compare').checked) {
              result2 = calculate('2');
            } else {
              result2 = { totalValues: [], interestValues: [], taxValues: [], totalProfitValues: [], years: 0 };
            }
            generateChart([result1, result2]);
            updateResults(
              result1.totalValues[result1.totalValues.length - 1],
              result1.interestValues[result1.interestValues.length - 1] / result1.years,
              result1.taxValues[result1.taxValues.length - 1] / result1.years,
              result1.totalValues[result1.totalValues.length - 1] - result1.totalValues[0],
              result2.totalValues[result2.totalValues.length - 1],
              result2.interestValues[result2.interestValues.length - 1] / result2.years,
              result2.taxValues[result2.taxValues.length - 1] / result2.years,
              result2.totalValues[result2.totalValues.length - 1] - result2.totalValues[0]
            );
          }

          function calculate(suffix) {
            const amount = parseFloat(document.getElementById('amount' + suffix).value);
            const years = parseFloat(document.getElementById('years' + suffix).value) * 12;
            const tax = parseFloat(document.getElementById('tax' + suffix).value) / 100;
            const interest = parseFloat(document.getElementById('interest' + suffix).value) / 100;

            let total = amount;
            let totalInterest = 0;
            let totalTax = 0;
            const totalValues = [amount];
            const taxValues = [];
            const interestValues = [];
            const totalProfitValues = [];

            for (let i = 0; i < years; i++) {
              const currentInterest = total * (interest / 12);
              const currentTax = currentInterest * tax;
              totalInterest += currentInterest;
              totalTax += currentTax;
              total += currentInterest - currentTax;
              taxValues.push(totalTax);
              interestValues.push(totalInterest);
              totalValues.push(total);
              totalProfitValues.push(total - amount);
            }

            return { totalValues, interestValues, taxValues, totalProfitValues, years, tax, interest };
          }

          function generateChart(results) {
  const ctx = document.getElementById('myChart').getContext('2d');

  if (myChart) {
    myChart.destroy();
  }

  const datasets = [];

  results.forEach((result, index) => {
    const suffix = index > 0 ? ` ${index + 1}` : '';
    datasets.push(
      {
        label: `Heildarupphæð${suffix}`,
        data: result.totalValues,
        borderColor: 'rgb(75, 192, 192)',
        fill: false
      },
      {
        label: `Vextir${suffix}`,
        data: result.interestValues,
        borderColor: 'rgb(54, 162, 235)',
        fill: false
      },
      {
        label: `Fjármagnstekjuskattur${suffix}`,
        data: result.taxValues,
        borderColor: 'rgb(255, 99, 132)',
        fill: false
      },
      {
        label: `Heildarhagnaður${suffix}`,
        data: result.totalProfitValues,
        borderColor: 'rgb(255, 206, 86)',
        fill: false
      },
      {
        label: `Mánaðarlegur hagnaður${suffix}`,
        data: result.totalProfitValues.map(profit => profit / result.years / 12),
        borderColor: 'rgb(153, 102, 255)',
        fill: false
      }
    );
  });

  const chartData = {
    labels: [...Array(results[0].years).keys()].map(i => i + 1),
    datasets: datasets
  };

  const investmentCount = results.length;
  const chartTitle = investmentCount > 1 ? `Fjárhagurleg áhorfunt (Fjárfestingar: ${investmentCount})` : 'Fjárhagurleg áhorfunt';

  myChart = new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: {
      responsive: true,
      title: {
        display: true,
        text: chartTitle
      },
      tooltips: {
        mode: 'index',
        intersect: false
      },
      hover: {
        mode: 'nearest',
        intersect: true
      },
      scales: {
        x: {
          display: true,
          title: {
            display: true,
            text: 'Mánuðir'
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: 'Upphæð'
          },
          beginAtZero: scaleFromZero
        }
      }
    }
  });
}


          function disableAllPlots() {
            if (myChart) {
              myChart.data.datasets.forEach(dataset => {
                dataset.hidden = true;
              });
              myChart.update();
            }
          }

          function updateResults(total1, interest1, tax1, totalProfit1, total2, interest2, tax2, totalProfit2) {
            const totalFormatted1 = formatISK(total1);
            const interestFormatted1 = formatISK(interest1);
            const taxFormatted1 = formatISK(tax1);
            const totalProfitFormatted1 = formatISK(totalProfit1);
            const totalFormatted2 = formatISK(total2);
            const interestFormatted2 = formatISK(interest2);
            const taxFormatted2 = formatISK(tax2);
            const totalProfitFormatted2 = formatISK(totalProfit2);
            const years = document.getElementById('years1').value;
            const monthlyprofit1Formatted = formatISK(totalProfit1 / (years * 12));
            const monthlyprofit2Formatted = formatISK(totalProfit2 / (years * 12));

            document.querySelector('.results1 #totalresult1').innerHTML = `Heildarupphæð 1 eftir ${years} ár: <span class="amount">${totalFormatted1}</span>`;
            document.querySelector('.results1 #interestresult1').innerHTML = `Samtals vextir 1 eftir ${years} ár: <span class="amount">${interestFormatted1}</span>`;
            document.querySelector('.results1 #taxresult1').innerHTML = `Samtals fjármagnstekjuskattur 1 eftir ${years} ár: <span class="amount">${taxFormatted1}</span>`;
            document.querySelector('.results1 #totaltax1').innerHTML = `Heildarhagnaður 1 eftir ${years} ár: <span class="amount">${totalProfitFormatted1}</span>`;
            document.querySelector('.results2 #totalresult2').innerHTML = `Heildarupphæð 2 eftir ${years} ár: <span class="amount">${totalFormatted2}</span>`;
            document.querySelector('.results2 #interestresult2').innerHTML = `Samtals vextir 2  eftir ${years} ár: <span class="amount">${interestFormatted2}</span>`;
            document.querySelector('.results2 #taxresult2').innerHTML = `Samtals fjármagnstekjuskattur 2 eftir ${years} ár: <span class="amount">${taxFormatted2}</span>`;
            document.querySelector('.results2 #totaltax2').innerHTML = `Heildarhagnaður 2 eftir ${years} ár: <span class="amount">${totalProfitFormatted2}</span>`;
            document.querySelector('.results1 #monthlyprofit1').innerHTML = `Mánaðarlegur hagnaður 1: <span class="amount">${monthlyprofit1Formatted}</span>`;
            document.querySelector('.results2 #monthlyprofit2').innerHTML = `Mánaðarlegur hagnaður 2: <span class="amount">${monthlyprofit2Formatted}</span>`;
          }

          ['amount1', 'amount2', 'years1', 'years2', 'tax1', 'interest1', 'tax2', 'interest2', 'compare'].forEach(id => {
            document.getElementById(id).addEventListener('change', calculateAndCompare);
          });

          document.getElementById('compare').addEventListener('change', function() {
            document.getElementById('investment2').style.display = this.checked ? 'block' : 'none';
            calculateAndCompare();
          });

          calculateAndCompare();
        });
    </script>
</body>
</html>
