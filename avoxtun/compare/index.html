<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ávöxtun</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <div>
        <div class="input-container">
            <label for="years">Fjöldi ára</label>
            <input type="number" id="years" value="2">
            <label for="interest">Vextir (prósenta)</label>
            <input type="number" id="interest" value="8.25">
            <label for="tax">Fjármagnstekjuskattur (prósenta)</label>
            <input type="number" id="tax" value="22">
            <label for="amount">Upprunaleg upphæð</label>
            <input type="number" id="amount1" value="50000000">
            <div id="investment2">
                <h2>Investment 2</h2>
                <label for="amount">Upprunaleg upphæð</label>
                <input type="number" id="amount2" value="76000000">
            </div>
        </div>
        <input type="checkbox" id="compare" checked>
        <label for="compare">Compare with second value</label>
        <br/>
        <input type="checkbox" id="toggleScale">
        <label for="toggleScale">Scale from Zero</label>
    </div>
    <canvas id="myChart"></canvas>
    <script>
        let myChart;
        let scaleFromZero = false;

        document.getElementById('toggleScale').addEventListener('change', function() {
            scaleFromZero = this.checked;
            calculateAndCompare();
        });

        function calculateAndCompare() {
            const result1 = calculate('1');
            let result2;
            if (document.getElementById('compare').checked) {
                result2 = calculate('2');
            } else {
                result2 = { totalValues: [], interestValues: [], taxValues: [], profitValues: [], totalProfitValues: [], currentProfitValues: [] };
            }
            generateChart(result1.totalValues, result2.totalValues, result1.interestValues, result2.interestValues, result1.taxValues, result2.taxValues, result1.profitValues, result2.profitValues, result1.totalProfitValues, result2.totalProfitValues, result1.currentProfitValues, result2.currentProfitValues, result1.years);
        }

        function calculate(suffix) {
            const amount = parseFloat(document.getElementById('amount' + suffix).value);
            const years = parseFloat(document.getElementById('years').value) * 12;
            const tax = parseFloat(document.getElementById('tax').value) / 100;
            const interest = parseFloat(document.getElementById('interest').value) / 100;

            let total = amount;
            let totalInterest = 0;
            let totalTax = 0;
            const totalValues = [amount];
            const taxValues = [];
            const interestValues = [];
            const profitValues = [];
            const totalProfitValues = [];
            const currentProfitValues = [];

            for (let i = 0; i < years; i++) {
                const currentInterest = total * (interest / 12);
                const currentTax = currentInterest * tax;
                totalInterest += currentInterest;
                totalTax += currentTax;
                total += (currentInterest - currentTax);
                taxValues.push(totalTax);
                interestValues.push(totalInterest);
                totalValues.push(total);
                profitValues.push(currentInterest - currentTax);
                totalProfitValues.push(total - amount);
                currentProfitValues.push(currentInterest - currentTax);
            }

            return { totalValues, interestValues, taxValues, profitValues, totalProfitValues, currentProfitValues, years, tax, interest };
        }

        function generateChart(totalValues1, totalValues2, interestValues1, interestValues2, taxValues1, taxValues2, profitValues1, profitValues2, totalProfitValues1, totalProfitValues2, currentProfitValues1, currentProfitValues2, years) {
            const ctx = document.getElementById('myChart').getContext('2d');

            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [...Array(years).keys()].map(i => i + 1),
                    datasets: [{
                        label: 'Total 1',
                        data: totalValues1,
                        borderColor: 'rgb(75, 192, 192)',
                        fill: false
                    }, {
                        label: 'Interest 1',
                        data: interestValues1,
                        borderColor: 'rgb(54, 162, 235)',
                        fill: false
                    }, {
                        label: 'Tax 1',
                        data: taxValues1,
                        borderColor: 'rgb(255, 99, 132)',
                        fill: false
                    }, {
                        label: 'Profit per month 1',
                        data: profitValues1,
                        borderColor: 'rgb(153, 102, 255)',
                        fill: false
                    }, {
                        label: 'Total Profit 1',
                        data: totalProfitValues1,
                        borderColor: 'rgb(255, 206, 86)',
                        fill: false
                    }, {
                        label: 'Current Profit 1',
                        data: currentProfitValues1,
                        borderColor: 'rgb(255, 159, 64)',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Financial Overview'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Mánuðir'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'upphæð'
                            },
                            beginAtZero: scaleFromZero
                        }
                    }
                }
            });

            if (document.getElementById('compare').checked) {
                myChart.data.datasets.push({
                    label: 'Total 2',
                    data: totalValues2,
                    borderColor: 'rgb(255, 159, 64)',
                    fill: false
                }, {
                    label: 'Interest 2',
                    data: interestValues2,
                    borderColor: 'rgb(153, 102, 255)',
                    fill: false
                }, {
                    label: 'Tax 2',
                    data: taxValues2,
                    borderColor: 'rgb(255, 159, 64)',
                    fill: false
                }, {
                    label: 'Profit per month 2',
                    data: profitValues2,
                    borderColor: 'rgb(75, 192, 192)',
                    fill: false
                }, {
                    label: 'Total Profit 2',
                    data: totalProfitValues2,
                    borderColor: 'rgb(255, 206, 86)',
                    fill: false
                }, {
                    label: 'Current Profit 2',
                    data: currentProfitValues2,
                    borderColor: 'rgb(255, 99, 132)',
                    fill: false
                });
                myChart.update();
            }
        }

        ['amount1', 'amount2', 'years', 'tax', 'interest', 'compare'].forEach(id => {
            document.getElementById(id).onchange = calculateAndCompare;
        });

        document.getElementById('compare').onchange = function() {
            document.getElementById('investment2').style.display = this.checked ? 'block' : 'none';
            calculateAndCompare();
        };

        calculateAndCompare();
    </script>
</body>

</html>
